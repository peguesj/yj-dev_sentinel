# Test Coverage Constraints

Test coverage constraints ensure that code is adequately tested, reducing the risk of bugs and regressions.

## Available Constraints

### TCOV001: Line Coverage

- **ID**: `test-line-coverage`
- **Severity**: Warning
- **Description**: Ensures that a sufficient percentage of code lines are covered by tests.
- **Rule**: Line coverage should meet or exceed the configured threshold (default: 80%).
- **Auto-fixable**: No

### TCOV002: Branch Coverage

- **ID**: `test-branch-coverage`
- **Severity**: Warning
- **Description**: Ensures that a sufficient percentage of code branches (conditionals) are covered by tests.
- **Rule**: Branch coverage should meet or exceed the configured threshold (default: 75%).
- **Auto-fixable**: No

### TCOV003: Function/Method Coverage

- **ID**: `test-function-coverage`
- **Severity**: Warning
- **Description**: Ensures that a sufficient percentage of functions and methods are covered by tests.
- **Rule**: Function/method coverage should meet or exceed the configured threshold (default: 90%).
- **Auto-fixable**: No

### TCOV004: Critical Path Coverage

- **ID**: `test-critical-path-coverage`
- **Severity**: Error
- **Description**: Ensures that critical paths (like authentication, security features, data persistence) are well-tested.
- **Rule**: Critical path coverage should meet or exceed the configured threshold (default: 95%).
- **Auto-fixable**: No

### TCOV005: Test Existence

- **ID**: `test-existence`
- **Severity**: Warning
- **Description**: Ensures that test files exist for all source code files.
- **Rule**: Each source code file should have a corresponding test file.
- **Auto-fixable**: Yes (can generate test file templates)

### TCOV006: Edge Case Coverage

- **ID**: `test-edge-case-coverage`
- **Severity**: Info
- **Description**: Encourages testing of edge cases and boundary conditions.
- **Rule**: Tests should include edge cases like empty inputs, maximum values, error conditions, etc.
- **Auto-fixable**: No

### TCOV007: Public API Coverage

- **ID**: `test-public-api-coverage`
- **Severity**: Warning
- **Description**: Ensures that all public APIs are tested.
- **Rule**: All public methods, functions, and classes should be covered by tests.
- **Auto-fixable**: No

### TCOV008: Test/Code Ratio

- **ID**: `test-code-ratio`
- **Severity**: Info
- **Description**: Encourages a healthy ratio of test code to production code.
- **Rule**: The ratio of test code to production code should meet or exceed the configured threshold (default: 0.7).
- **Auto-fixable**: No

## Coverage Reports

Test coverage constraints rely on coverage reports generated by tools like:

- **Python**: pytest-cov, coverage.py
- **JavaScript**: Istanbul, Jest
- **Java**: JaCoCo, JUnit
- **Go**: go test -cover

Here's an example of a coverage report:

```text
Name                          Stmts   Miss  Cover   Missing
-----------------------------------------------------------
src/auth/authentication.py      45      8    82%    21-25, 77-82
src/auth/authorization.py       38      2    95%    45, 67
src/auth/__init__.py             2      0   100%
-----------------------------------------------------------
TOTAL                           85     10    88%
```

## Enforcement

Test coverage constraints are typically enforced during:

- **Pull request validation**: Ensure code meets test coverage standards before merging
- **Continuous Integration**: Regular coverage checks as part of the CI pipeline
- **Pre-release quality gates**: Validate coverage before promoting code to production

## Configuration

Test coverage constraints can be configured in the project's `.force/config.json` file:

```json
{
  "constraints": {
    "test-coverage": {
      "line-coverage": {
        "enabled": true,
        "severity": "warning",
        "threshold": 80
      },
      "branch-coverage": {
        "enabled": true,
        "severity": "warning",
        "threshold": 75
      },
      "critical-paths": [
        "src/auth/**/*.py",
        "src/payment/**/*.py"
      ],
      "critical-path-coverage": {
        "threshold": 95
      }
    }
  }
}
```

## Improving Test Coverage

To improve test coverage:

1. **Identify uncovered code**: Use coverage reports to find untested code
2. **Focus on critical paths**: Prioritize testing of important functionality
3. **Use TDD**: Write tests before implementation
4. **Automate test generation**: Use tools to generate test templates
5. **Include edge cases**: Test boundary conditions and unusual inputs
6. **Mock dependencies**: Use mocks to isolate code during testing

## Related Constraints

- [Test Quality Constraints](test-quality.md)

## Related Patterns

- [Test Generation Pattern](../patterns/test-generation.md)
- [Code Analysis Pattern](../patterns/code-analysis.md)
